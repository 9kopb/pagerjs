/*! pager.js - v0.1.0 - 2012-08-11
* http://oscar.finnsson.nu/pagerjs/
* Copyright (c) 2012 Oscar Finnsson; Licensed MIT */
var ChildManager=function(a,b){var c=null;this.showChild=function(){c&&(c.hide(),c=null);var d=!1,e=b()[0],f=null;_.each(a(),function(a){if(!d){var b=ko.utils.unwrapObservable(a.valueAccessor());if(b.id===e||(e===""||e==null)&&b.id==="start")d=!0,c=a;b.id==="?"&&(f=a)}}),c||(c=f),c&&c.show()}},pager={};window.pager=pager,pager.start=function(a){var b=function(){pager.route(a.$page,window.location.hash)};$(window).bind("hashchange",b),b()},pager.extendWithPage=function(a){a.$page=ko.observable({children:ko.observableArray([]),route:ko.observableArray([]),parentRoute:ko.observableArray([]),__id__:Math.random()}),pager.childManager=new ChildManager(a.$page().children,a.$page().route)},pager.route=function(a,b){b[0]==="#"&&(b=b.slice(1));var c=b.split("/");a().route(c),pager.childManager.showChild()},pager.Page=function(a,b,c,d,e){this.element=a,this.valueAccessor=b,this.allBindingsAccessor=c,this.viewModel=d,this.bindingContext=e,$(a).hide();var f=ko.utils.unwrapObservable(b()),g=e.$page||e.$data.$page,h=g(),i=ko.observableArray([]),j=ko.observableArray([]),k=function(a){return f.id==="?"?a.replace("{1}",h.route()[0]):a},l=function(b){if(f.frame==="iframe"){var c=$("iframe",$(a));c.length===0&&(c=$("<iframe></iframe>"),$(a).append(c)),c.attr("src",k(b))}else $(a).load(k(b))},m=function(){var b=$(a);b.is(":visible")||($(a).show(),f.sourceOnShow&&(!f.sourceCache||!a.__pagerLoaded__||typeof f.sourceCache=="number"&&a.__pagerLoaded__+f.sourceCache*1e3<Date.now())&&(a.__pagerLoaded__=Date.now(),l(f.sourceOnShow)))};h.children.push({valueAccessor:b,element:a,page:h,show:function(){m(),n.showChild()},hide:function(){$(a).hide()}}),ko.computed(function(){i(h.route().slice(1));if(h.parentRoute){var a=h.parentRoute().slice(0);a.push(f.id),j(a)}else j([f.id])});var n=null,o={$page:ko.observable({children:ko.observableArray([]),parentRoute:j,route:i,__id__:Math.random()})};this.init=function(){n=new ChildManager(o.$page().children,i),f.source&&l(f.source);var b=e.createChildContext(f["with"]?f["with"]:d);return ko.utils.extend(b,o),ko.applyBindingsToDescendants(b,a),{controlsDescendantBindings:!0}}},ko.bindingHandlers.page={init:function(a,b,c,d,e){var f=new pager.Page(a,b,c,d,e);return f.init()},update:function(a,b,c,d,e){}},ko.bindingHandlers["page-href"]={init:function(a,b,c,d,e){var f=e.$page||e.$data.$page,g=f();ko.computed(function(){var c=ko.utils.unwrapObservable(b()),d=0;while(c.substring(0,3)==="../")d++,c=c.slice(3);var e=g.parentRoute().slice(0,g.parentRoute().length-d).join("/");$(a).attr({href:"#"+(e===""?"":e+"/")+c})})},update:function(a,b,c,d,e){}};